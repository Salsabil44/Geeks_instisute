{% extends "base.html" %}

{% block title %}{{ course.course_name }} - Course Details{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Page Header -->
    <div class="flex justify-between items-center">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">{{ course.course_name }}</h1>
            <p class="text-gray-600">Course Code: {{ course.course_code }}</p>
        </div>
        <div class="flex space-x-3">
            <a href="{{ url_for('course_edit', id=course.id) }}" class="bg-indigo-500 hover:bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                Edit Course
            </a>
            <a href="{{ url_for('courses_list') }}" class="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                Back to Courses
            </a>
        </div>
    </div>

    <!-- Course Information -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Course Information</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <h3 class="text-lg font-medium text-gray-900 mb-3">Basic Details</h3>
                <dl class="space-y-2">
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Course Name</dt>
                        <dd class="text-sm text-gray-900">{{ course.course_name }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Course Code</dt>
                        <dd class="text-sm text-gray-900">{{ course.course_code }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Credits</dt>
                        <dd class="text-sm text-gray-900">{{ course.credits }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Description</dt>
                        <dd class="text-sm text-gray-900">{{ course.description if course.description else 'No description available' }}</dd>
                    </div>
                </dl>
            </div>
            <div>
                <h3 class="text-lg font-medium text-gray-900 mb-3">Enrollment & Capacity</h3>
                <dl class="space-y-2">
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Current Enrollment</dt>
                        <dd class="text-sm text-gray-900">{{ enrollments|length }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Maximum Students</dt>
                        <dd class="text-sm text-gray-900">{{ course.max_students if course.max_students else 'Not set' }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Available Spots</dt>
                        <dd class="text-sm text-gray-900">
                            {% if course.max_students %}
                                {{ course.max_students - enrollments|length }}
                            {% else %}
                                Unlimited
                            {% endif %}
                        </dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Status</dt>
                        <dd class="text-sm">
                            {% if course.max_students %}
                                {% set available = course.max_students - enrollments|length %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                                    {% if available > 0 %}bg-green-100 text-green-800
                                    {% elif available == 0 %}bg-yellow-100 text-yellow-800
                                    {% else %}bg-red-100 text-red-800{% endif %}">
                                    {% if available > 0 %}Open
                                    {% elif available == 0 %}Full
                                    {% else %}Overflow{% endif %}
                                </span>
                            {% else %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                    Open
                                </span>
                            {% endif %}
                        </dd>
                    </div>
                </dl>
            </div>
        </div>
    </div>

    <!-- Teacher Information -->
    {% if course.teacher %}
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Assigned Teacher</h2>
        <div class="flex items-center">
            <div class="flex-shrink-0 h-12 w-12">
                <div class="h-12 w-12 rounded-full bg-green-100 flex items-center justify-center">
                    <span class="text-green-600 font-medium text-lg">{{ course.teacher.first_name[0] if course.teacher.first_name else 'T' }}{{ course.teacher.last_name[0] if course.teacher.last_name else 'e' }}</span>
                </div>
            </div>
            <div class="ml-4">
                <h3 class="text-lg font-medium text-gray-900">{{ course.teacher.full_name if course.teacher.full_name else 'Unknown Teacher' }}</h3>
                <p class="text-gray-600">{{ course.teacher.subject_specialty if course.teacher.subject_specialty else 'No specialty specified' }}</p>
                <p class="text-gray-500">{{ course.teacher.email if course.teacher.email else 'No email available' }}</p>
            </div>
            <div class="ml-auto">
                <a href="{{ url_for('teacher_details', id=course.teacher.id) }}" class="text-blue-600 hover:text-blue-900 text-sm">View Teacher Profile</a>
            </div>
        </div>
    </div>
    {% else %}
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Teacher Assignment</h2>
        <div class="text-center py-4">
            <div class="text-gray-400 mb-2">
                <svg class="mx-auto h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
            </div>
            <p class="text-gray-500">No teacher assigned to this course</p>
            <a href="{{ url_for('course_edit', id=course.id) }}" class="text-blue-600 hover:text-blue-900 text-sm">Assign Teacher</a>
        </div>
    </div>
    {% endif %}

    <!-- Enrolled Students -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Enrolled Students ({{ enrollments|length }})</h2>
        {% if enrollments %}
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Enrollment Date</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Grade</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for enrollment in enrollments %}
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-8 w-8">
                                    <div class="h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center">
                                        <span class="text-blue-600 font-medium text-xs">{{ enrollment.student.first_name[0] if enrollment.student.first_name else 'S' }}{{ enrollment.student.last_name[0] if enrollment.student.last_name else 't' }}</span>
                                    </div>
                                </div>
                                <div class="ml-3">
                                    <div class="text-sm font-medium text-gray-900">{{ enrollment.student.full_name if enrollment.student.full_name else 'Unknown Student' }}</div>
                                    <div class="text-sm text-gray-500">{{ enrollment.student.student_id if enrollment.student.student_id else 'No ID' }}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            {{ enrollment.enrollment_date.strftime('%B %d, %Y') if enrollment.enrollment_date else 'Not specified' }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            {% set student_grade = none %}
                            {% for grade in grades %}
                                {% if grade.student_id == enrollment.student.id %}
                                    {% set student_grade = grade %}
                                {% endif %}
                            {% endfor %}
                            {% if student_grade %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                    {{ student_grade.grade_letter if student_grade.grade_letter else 'N/A' }}
                                </span>
                            {% else %}
                                <span class="text-gray-400 text-sm">No grade</span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <a href="{{ url_for('student_details', id=enrollment.student.id) }}" class="text-blue-600 hover:text-blue-900">View Student</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-8">
            <div class="text-gray-400 mb-4">
                <svg class="mx-auto h-12 w-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                </svg>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">No students enrolled</h3>
            <p class="text-gray-500">This course currently has no enrolled students.</p>
        </div>
        {% endif %}
    </div>

    <!-- Course Grades -->
    {% if grades %}
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Course Grades</h2>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Grade</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Semester</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Academic Year</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for grade in grades %}
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-8 w-8">
                                    <div class="h-8 w-8 rounded-full bg-green-100 flex items-center justify-center">
                                        <span class="text-green-600 font-medium text-xs">{{ grade.student.first_name[0] if grade.student.first_name else 'S' }}{{ grade.student.last_name[0] if grade.student.last_name else 't' }}</span>
                                    </div>
                                </div>
                                <div class="ml-3">
                                    <div class="text-sm font-medium text-gray-900">{{ grade.student.full_name if grade.student.full_name else 'Unknown Student' }}</div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex items-center space-x-2">
                                {% if grade.grade_value %}
                                <span class="text-sm text-gray-900">{{ grade.grade_value }}</span>
                                {% endif %}
                                {% if grade.grade_letter %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                    {{ grade.grade_letter }}
                                </span>
                                {% endif %}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ grade.semester if grade.semester else 'N/A' }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ grade.academic_year if grade.academic_year else 'N/A' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
